<!DOCTYPE html>
<html x-data="app" x-cloak x-init="initialize" x-bind:data-theme="darkTheme ? 'dark' : 'light'">

<head>
  <meta charset="UTF-8" />
  <title>Positron</title>
</head>

<body x-data="{modals: {settings: {open: false}, about: {open: false}, response: {open: false, content: ''}}}">
  <div class="container-fluid">

    <!-- Top nav -->
    <header>
      <nav>
        <ul>
          <li><span class="bigger">Positron</span></li>
        </ul>
        <ul>
          <li><button @click="modals.settings.open=true">Settings</button></li>
          <li><button @click="modals.about.open=true">About</button></li>
        </ul>
      </nav>
    </header>

    <!-- Main content -->
    <main class="container">

      <!-- Shortcuts -->
      <template x-for="shortcut in shortcuts">
        <article x-data="{open:false,ok:true}">
          <details x-bind:open="open">

            <!-- Header -->
            <summary>
              <input type="checkbox" role="switch" @click="ok=await toggleShortcut(shortcut)" x-model="shortcut.enabled">
              <span x-text="shortcut.name"></span>
            </summary>
            <br />

            <!-- Name/Accelerator -->
            <div class="grid">

              <!-- Name -->
              <label for="name">
                Name
                <input type="text" id="name" x-model="shortcut.name" x-bind:disabled="shortcut.enabled">
              </label>

              <!-- Accelerator -->
              <label for="accelerator">
                Accelerator
                <input type="text" id="accelerator" x-model="shortcut.acc" x-bind:disabled="shortcut.enabled" x-bind:aria-invalid="!ok">
                <small x-show="!ok">Accelerator is invalid or already in use</small>
              </label>
            </div>

            <!-- Method/Endpoint -->
            <div class="grid-1-4">

              <!-- Method -->
              <div class="grid-1-4-1">
                <label for="method">
                  Method
                  <select id="method" x-model="shortcut.params.method" x-bind:disabled="shortcut.enabled">
                    <option value="GET">GET</option>
                    <option value="POST">POST</option>
                  </select>
                </label>
              </div>

              <!-- Endpoint -->
              <div class="grid-1-4-2">
                <label for="endpoint">
                  Endpoint
                  <input type="text" id="endpoint" x-model="shortcut.params.endpoint" x-bind:disabled="shortcut.enabled">
                </label>
              </div>
            </div>

            <!-- Request body -->
            <label for="request-body">
              Request body
              <input type="text" id="request-body" x-model="shortcut.params.body" x-bind:disabled="shortcut.enabled">
            </label>
            <br />

            <!-- Trigger/Delete -->
            <div class="grid">
              <button @click="async () => { modals.response.content=await triggerShortcut(shortcut); modals.response.open=true; }">Trigger</button>
              <button @click="deleteShortcut(shortcut)" class="darkred">Delete</button>
            </div>

          </details>
        </article>
      </template>

      <!-- Create new shortcut -->
      <button @click="createShortcut" class="darkgreen">New shortcut</button>
    </main>
  </div>

  <!-- Modals -->

  <!-- Settings -->
  <dialog open x-show="modals.settings.open" x-transition>
    <article>
      <header>
        <span class="bigger">Settings</span>
      </header>

      <!-- Server settings -->
      <h4>Server</h4>

      <!-- Protocol/Host -->
      <div class="grid-1-4">

        <!-- Protocol -->
        <div class="grid-1-4-1">
          <label for="protocol">
            Protocol
            <select id="protocol" x-model="server.protocol">
              <option value="http">HTTP</option>
              <option value="https">HTTPS</option>
            </select>
          </label>
        </div>

        <!-- Hostname -->
        <div class="grid-1-4-2">
          <label for="hostname">
            Hostname
            <input type="text" id="hostname" x-model="server.hostname">
          </label>
        </div>
      </div>

      <!-- Port -->
      <label for="port">
        Port
        <input type="text" id="port" x-model="server.port">
      </label>

      <!-- Token -->
      <label for="token">
        Long-Lived Access Token
        <input type="text" id="token" x-model="server.token">
      </label>

      <!-- Appearence settings -->
      <h4>Appearence</h4>

      <label for="darkTheme">
        Dark Theme
        <input type="checkbox" role="switch" name="darkTheme" @click="toggleDarkTheme" x-model="darkTheme">
      </label>
      <br />

      <!-- User config file settings -->
      <h4>Configuration file</h4>

      <div class="grid">
        <button @click="loadUserConfig">Reload</button>
        <button @click="openUserConfig">Open</button>
      </div>

      <footer>
        <div class="grid">
          <button @click="modals.settings.open=false" class="secondary">Close without saving</button>
          <button @click="async () => { await saveUserConfig(); modals.settings.open=false; }" class="darkgreen">Save and close</button>
        </div>
      </footer>
    </article>
  </dialog>

  <!-- About -->
  <dialog open x-show="modals.about.open" x-transition>
    <article>
      <header>
        <span class="bigger">About</span>
      </header>
      <p>Agust√≠n Mista</p>
      <footer>
        <button @click="modals.about.open=false" class="darkgreen">Close</button>
      </footer>
    </article>
  </dialog>

  <!-- Response -->
  <dialog open x-show="modals.response.open" x-transition>
    <article>
      <header>
        <span class="bigger">Response</span>
      </header>
      <span x-html="modals.response.content"></span>
      <footer>
        <button @click="modals.response.open=false" class="darkgreen">Close</button>
      </footer>
    </article>
  </dialog>
</body>

</html>