<!DOCTYPE html>
<html x-data="app" x-cloak x-init="initialize" x-bind:data-theme="darkTheme ? 'dark' : 'light'">

<head>
  <meta charset="UTF-8" />
  <title>Positron</title>
</head>

<body>
  <div class="container-fluid">

    <!-- Top nav -->
    <header>
      <nav>
        <ul>
          <li><span class="bigger">Positron</span></li>
        </ul>
        <ul>
          <li><button @click="$store.settingsModal.open()">Settings</button></li>
          <li><button @click="$store.aboutModal.open()">About</button></li>
        </ul>
      </nav>
    </header>

    <!-- Main content -->
    <main class="container">

      <!-- Shortcuts -->
      <template x-for="shortcut in shortcuts">
        <article x-data="{ok: true}">
          <details>

            <!-- Header -->
            <summary>
              <input type="checkbox" role="switch" @click="ok=await toggleShortcut(shortcut)" x-model="shortcut.enabled" x-bind:aria-invalid="!ok">
              <span x-text="shortcut.name"></span>
            </summary>
            <br />

            <!-- Name/Accelerator -->
            <div class="grid">

              <!-- Name -->
              <label for="name">
                Name
                <input type="text" id="name" x-model="shortcut.name" x-bind:disabled="shortcut.enabled">
              </label>

              <!-- Accelerator -->
              <label for="accelerator">
                Accelerator
                <input type="text" id="accelerator" x-model="shortcut.acc" x-bind:disabled="shortcut.enabled" x-bind:aria-invalid="!ok">
                <small x-show="!ok">Accelerator is invalid or already in use</small>
              </label>
            </div>

            <!-- Method/Endpoint -->
            <div class="grid-1-4">

              <!-- Method -->
              <div class="grid-1-4-1">
                <label for="method">
                  Method
                  <select id="method" x-model="shortcut.params.method" x-bind:disabled="shortcut.enabled">
                    <option value="GET">GET</option>
                    <option value="POST">POST</option>
                  </select>
                </label>
              </div>

              <!-- Endpoint -->
              <div class="grid-1-4-2">
                <label for="endpoint">
                  Endpoint
                  <input type="text" id="endpoint" x-model="shortcut.params.endpoint" x-bind:disabled="shortcut.enabled">
                </label>
              </div>
            </div>

            <!-- Request body -->
            <label for="request-body">
              Request body
              <input type="text" id="request-body" x-model="shortcut.params.body" x-bind:disabled="shortcut.enabled">
            </label>

            <!-- Custom handler -->
            <label for="custom-handler">
              <input type="checkbox" role="switch" @click="toggleShortcutHandler(shortcut)" x-model="shortcut.handler.enabled" x-bind:disabled="shortcut.enabled">
              Send custom notification
              <!-- <input type="text" id="custom-handler" x-model="shortcut.handler.code" x-bind:disabled="shortcut.enabled"> -->
              <textarea id="custom-handler" rows="3" x-show="shortcut.handler.enabled" x-model="shortcut.handler.code" x-bind:disabled="shortcut.enabled"></textarea>
            </label>
            <br />

            <!-- Trigger/Delete -->
            <div class="grid">
              <button @click="triggerShortcut(shortcut).then(content => $store.responseModal.open(content))">Trigger</button>
              <button @click="deleteShortcut(shortcut)" class="darkred">Delete</button>
            </div>

          </details>
        </article>
      </template>

      <!-- Create new shortcut -->
      <button @click="createShortcut()" class="darkgreen">New shortcut</button>
    </main>
  </div>

  <!-- Modals -->

  <!-- Settings -->
  <dialog open x-show="$store.settingsModal.isOpen" x-transition>
    <article>
      <header>
        <span class="bigger">Settings</span>
      </header>

      <!-- Server settings -->
      <h4>Server</h4>

      <!-- Protocol/Host -->
      <div class="grid-1-4">

        <!-- Protocol -->
        <div class="grid-1-4-1">
          <label for="protocol">
            Protocol
            <select id="protocol" x-model="server.protocol">
              <option value="http">HTTP</option>
              <option value="https">HTTPS</option>
            </select>
          </label>
        </div>

        <!-- Hostname -->
        <div class="grid-1-4-2">
          <label for="hostname">
            Hostname
            <input type="text" id="hostname" x-model="server.hostname">
          </label>
        </div>
      </div>

      <!-- Port -->
      <label for="port">
        Port
        <input type="text" id="port" x-model="server.port">
      </label>

      <!-- Token -->
      <label for="token">
        Long-lived access token
        <input type="text" id="token" x-model="server.token">
      </label>

      <!-- Appearence settings -->
      <h4>Appearence</h4>

      <label for="darkTheme">
        Dark theme
        <input type="checkbox" role="switch" name="darkTheme" @click="toggleDarkTheme()" x-model="darkTheme">
      </label>
      <br />

      <!-- User config file settings -->
      <h4>Configuration file</h4>

      <div class="grid">
        <button @click="initialize()">Reload</button>
        <button @click="openUserConfig()">Open</button>
      </div>
      <br />

      <label for="autoSave">
        Auto save
        <input type="checkbox" role="switch" name="autoSave" @click="toggleAutoSave()" x-model="autoSave">
      </label>
      <small>Runs on shortcut creation, deletion and toggle</small>

      <footer>
        <a href="#" role="button" @click="$store.settingsModal.close()" class="secondary">Close without saving</a>
        <a href="#" role="button" @click="saveUserConfig().then($store.settingsModal.close())" class="darkgreen">Save and close</a>
      </footer>
    </article>
  </dialog>

  <!-- About -->
  <dialog open x-show="$store.aboutModal.isOpen" x-transition>
    <article>
      <header>
        <span class="bigger">About</span>
      </header>
      <p>Positron <span x-text="getAppVersion"></span></p>
      <p>Create keyboard shortcuts for Home Assistant actions.</p>
      <p>For more information about this application contact:</p>
      <p>Agust√≠n Mista (agustin@mista.me)</p>
      <footer>
        <a href="#" role="button" @click="$store.aboutModal.close()" class="darkgreen">Close</a>
      </footer>
    </article>
  </dialog>

  <!-- Response -->
  <dialog open x-show="$store.responseModal.isOpen" x-transition>
    <article>
      <header>
        <span class="bigger">Response</span>
      </header>
      <span x-html="$store.responseModal.data"></span>
      <footer>
        <a href="#" role="button" @click="$store.responseModal.close()" class="darkgreen">Close</a>
      </footer>
    </article>
  </dialog>

</body>

</html>